volumes:
  bot_logs:
  bot_tmp:

services:
  bot:
    extends:
      file: ./parents.yml
      service: custom_service
    build: ..
    ports:
      - ${BOT_EXTERNAL_PORT:-127.0.0.1:8080}:8080
    volumes:
      - bot_logs:/logs/bot:rw
      - ../build/${BOT_BUILD}/bot/BOT:/app:ro
    environment:
      - BOT_TOKEN=${BOT_TOKEN}
      - BOT_ADMINS=${BOT_ADMINS}
      - WEBHOOK_URL=${BOT_WEBHOOK_URL}
      - WEBHOOK_PATH=/webhook
      - DB_HOST=postgres
      - DB_PORT=5432
      - DB_NAME=${POSTGRES_DB}
      - DB_USER=${BOT_USER}
      - DB_PASSWORD=${BOT_PASSWORD}
      - RABBITMQ_HOST=rabbitmq
      - RABBITMQ_PORT=15672
      - RABBITMQ_USER=${RABBITMQ_DEFAULT_USER}
      - RABBITMQ_PASS=${RABBITMQ_DEFAULT_PASS}
      - RABBITMQ_VHOST=${RABBITMQ_VHOST}
      - LISTEN_IP=0.0.0.0
      - LISTEN_PORT=8080
      - YOUTUBE_API_URL=http://youtube_api:8080
      - TMP_PATH=/tmp/bot
      - LOGS_PATH=/logs/bot
      - SHARED_PATH=/shared/
      - DOWNLOADER_QUEUE_NAME=downloader
